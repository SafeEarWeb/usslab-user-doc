"use strict";(self.webpackChunkusslab_user_doc=self.webpackChunkusslab_user_doc||[]).push([[3376],{431:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var o=s(4848),r=s(8453);const i={sidebar_position:1,sidebar_label:"\u8fdc\u7a0b\u8c03\u8bd5",title:"\u8fdc\u7a0b\u8c03\u8bd5"},t=void 0,l={id:"tutorial-extras/remote_debug",title:"\u8fdc\u7a0b\u8c03\u8bd5",description:"\u5982\u679c\u9700\u8981\u8c03\u8bd5\uff0c\u53ef\u4ee5\u4f7f\u7528srun+pdb\u7684\u65b9\u6cd5\u8fdb\u884c\u3002\u8fd9\u91cc\u4e5f\u63d0\u4f9bvscode\u7684\u65b9\u6cd5\uff0c\u4f46\u518d\u6b21\u58f0\u660e\uff0c\u670d\u52a1\u5668\u4e0d\u63a8\u8350\u4f7f\u7528vscode\u767b\u5f55\u5230\u8282\u70b9\uff0c\u4e5f\u8bf7\u4e0d\u8981\u6ee5\u7528\u4e0b\u8ff0\u65b9\u6cd5\u30021\u548c2\u662f\u4e00\u6b21\u6027\u7684\u51c6\u5907\uff0c3\u662f\u6bcf\u6b21\u8c03\u8bd5\u90fd\u9700\u8981\u7684\u3002",source:"@site/docs/tutorial-extras/2_remote_debug.md",sourceDirName:"tutorial-extras",slug:"/tutorial-extras/remote_debug",permalink:"/usslab-user-doc/docs/tutorial-extras/remote_debug",draft:!1,unlisted:!1,editUrl:"https://github.com/IssacRunmin/usslab-user-doc/tree/main/docs/tutorial-extras/2_remote_debug.md",tags:[],version:"current",lastUpdatedAt:1730296732e3,sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"\u8fdc\u7a0b\u8c03\u8bd5",title:"\u8fdc\u7a0b\u8c03\u8bd5"},sidebar:"tutorialSidebar",previous:{title:"\u96c6\u7fa4\u8fdb\u9636",permalink:"/usslab-user-doc/docs/category/\u96c6\u7fa4\u8fdb\u9636"},next:{title:"\u73af\u5883\u7ba1\u7406",permalink:"/usslab-user-doc/docs/tutorial-extras/advance_opt"}},a={},c=[{value:"1. \u672c\u5730SSH\u5bc6\u94a5\u914d\u7f6e",id:"1-\u672c\u5730ssh\u5bc6\u94a5\u914d\u7f6e",level:2},{value:"1.1 \u672c\u5730SSH\u5bc6\u94a5\u751f\u6210",id:"11-\u672c\u5730ssh\u5bc6\u94a5\u751f\u6210",level:3},{value:"1.2 \u672c\u5730SSH\u914d\u7f6e",id:"12-\u672c\u5730ssh\u914d\u7f6e",level:3},{value:"1.3 \u672c\u5730SSH\u516c\u94a5\u4e0a\u4f20",id:"13-\u672c\u5730ssh\u516c\u94a5\u4e0a\u4f20",level:3},{value:"2. \u670d\u52a1\u5668\u5bc6\u94a5\u914d\u7f6e\u548c\u811a\u672c\u914d\u7f6e",id:"2-\u670d\u52a1\u5668\u5bc6\u94a5\u914d\u7f6e\u548c\u811a\u672c\u914d\u7f6e",level:2},{value:"2.1 \u670d\u52a1\u5668\u5bc6\u94a5\u914d\u7f6e",id:"21-\u670d\u52a1\u5668\u5bc6\u94a5\u914d\u7f6e",level:3},{value:"2.2 \u670d\u52a1\u5668\u811a\u672c\u914d\u7f6e",id:"22-\u670d\u52a1\u5668\u811a\u672c\u914d\u7f6e",level:3},{value:"3. \u6bcf\u6b21\u8c03\u8bd5\u8fd0\u884c\u7684\u65b9\u6cd5",id:"3-\u6bcf\u6b21\u8c03\u8bd5\u8fd0\u884c\u7684\u65b9\u6cd5",level:2},{value:"3.1 \u63d0\u4ea4\u4efb\u52a1",id:"31-\u63d0\u4ea4\u4efb\u52a1",level:3},{value:"3.2 vscode\u8fde\u63a5",id:"32-vscode\u8fde\u63a5",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"\u5982\u679c\u9700\u8981\u8c03\u8bd5\uff0c\u53ef\u4ee5\u4f7f\u7528srun+pdb\u7684\u65b9\u6cd5\u8fdb\u884c\u3002\u8fd9\u91cc\u4e5f\u63d0\u4f9bvscode\u7684\u65b9\u6cd5\uff0c\u4f46\u518d\u6b21\u58f0\u660e\uff0c\u670d\u52a1\u5668\u4e0d\u63a8\u8350\u4f7f\u7528vscode\u767b\u5f55\u5230\u8282\u70b9\uff0c\u4e5f\u8bf7\u4e0d\u8981\u6ee5\u7528\u4e0b\u8ff0\u65b9\u6cd5\u30021\u548c2\u662f\u4e00\u6b21\u6027\u7684\u51c6\u5907\uff0c3\u662f\u6bcf\u6b21\u8c03\u8bd5\u90fd\u9700\u8981\u7684\u3002"}),"\n",(0,o.jsx)(n.h2,{id:"1-\u672c\u5730ssh\u5bc6\u94a5\u914d\u7f6e",children:"1. \u672c\u5730SSH\u5bc6\u94a5\u914d\u7f6e"}),"\n",(0,o.jsx)(n.p,{children:"\u8be5\u65b9\u6cd5\u9700\u8981\u4f7f\u7528ssh public key\u767b\u5f55\u3002\u4e3a\u5b89\u5168\uff0c\u8bf7\u4f7f\u7528\u975e\u5bf9\u79f0\u5bc6\u94a5\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"11-\u672c\u5730ssh\u5bc6\u94a5\u751f\u6210",children:"1.1 \u672c\u5730SSH\u5bc6\u94a5\u751f\u6210"}),"\n",(0,o.jsxs)(n.p,{children:["\u8fd0\u884c",(0,o.jsx)(n.code,{children:"ssh-keygen"}),"\uff0c\u5982\u4e0b\u9762\u793a\u4f8b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# local machine\n# \u8fd0\u884cssh-keygen\uff0c\u4e00\u822c\u8fde\u6309\u51e0\u4e0b\u56de\u8f66\u5b8c\u6210ssh\u5bc6\u94a5\u751f\u6210\n<your-name>@<local-machine>:~$ ssh-keygen\nenerating public/private rsa key pair.\nEnter file in which to save the key (<path-to-home>/.ssh/id_rsa):\nEnter passphrase (empty for no passphrase):\nEnter same passphrase again:\nYour identification has been saved in <path-to-home>/.ssh/id_rsa\nYour public key has been saved in <path-to-home>/.ssh/id_rsa.pub\nThe key fingerprint is:\nSHA256:ioN6HjpxF627kkPnIiNVdYZ9JXH6UsE0lA3nPUb8AnA ourunmin@moon\nThe key's randomart image is:\n+---[RSA 3072]----+\n|       o  +BE+o. |\n|      o + .=+=oo |\n|     o o .. ...oo|\n|    o .    o  o o|\n|   . o  S . .  . |\n|. +.+. .   .     |\n| =o=o..          |\n|=o*.o.           |\n|+*.+..           |\n+----[SHA256]-----+\n"})}),"\n",(0,o.jsx)(n.h3,{id:"12-\u672c\u5730ssh\u914d\u7f6e",children:"1.2 \u672c\u5730SSH\u914d\u7f6e"}),"\n",(0,o.jsxs)(n.p,{children:["\u5728\u672c\u5730\u7684",(0,o.jsx)(n.code,{children:"~/.ssh/config"}),"\uff08Windows\u8def\u5f84\u4e00\u822c\u4e3a",(0,o.jsx)(n.code,{children:"C:\\Users\\[\u7528\u6237\u540d]\\.ssh\\config"}),"\uff09\u6dfb\u52a0\u5982\u4e0bhost\u3002\u5982\u679c\u627e\u4e0d\u5230\uff08\u9690\u85cf\u6587\u4ef6\u5939",(0,o.jsx)(n.code,{children:".ssh"}),"\uff09\u53ef\u4ee5\u901a\u8fc7vscode\u8fde\u63a5ssh\u65f6\u5019\u589e\u52a0\u914d\u7f6e\u627e\u5230\u914d\u7f6e\u6587\u4ef6\u3002",(0,o.jsxs)(n.strong,{children:["\u6ce8\u610f\u66f4\u6539\u4e24\u5904\u3010\u7528\u6237\u540d\u3011\uff08\u5982",(0,o.jsx)(n.code,{children:"ourunmin"}),"\uff09\u548c\u66f4\u6539\u3010\u7aef\u53e3\u53f7\u3011\uff08\u5982",(0,o.jsx)(n.code,{children:"2222"}),"\uff09"]}),"\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:'Host moon\n    HostName 10.14.101.139\n    Port 31415\n    User \u3010\u7528\u6237\u540d\u3011\nHost hpc-job\n    ProxyCommand ssh moon "nc \\$(squeue --me --name=code-tunnel --states=R -h -O NodeList) \u3010\u7aef\u53e3\u53f7\u3011"\n    StrictHostKeyChecking no\n    User \u3010\u7528\u6237\u540d\u3011\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u907f\u514d\u548c\u5176\u4ed6\u5c0f\u4f19\u4f34\u91cd\u590d\uff08\u5178\u578b\u7aef\u53e3\u53f71024-65535\uff09\u3002\u8fd9\u91cc\u7684moon\u662f\u767b\u5f55\u8282\u70b9\uff0chpc-job\u662f\u8c03\u8bd5\u8282\u70b9\uff0c\u8c03\u8bd5\u8282\u70b9\u6839\u636e\u63d0\u4ea4\u4efb\u52a1\u65f6\u5019\u5206\u914d\u7684\u8282\u70b9\u6765\u51b3\u5b9a\u8df3\u8f6c\u5230\u54ea\u91cc\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"13-\u672c\u5730ssh\u516c\u94a5\u4e0a\u4f20",children:"1.3 \u672c\u5730SSH\u516c\u94a5\u4e0a\u4f20"}),"\n",(0,o.jsxs)(n.p,{children:["\u5c06\u672c\u5730\u5bc6\u94a5\u7684\u516c\u94a5\u6dfb\u52a0\u5230\u670d\u52a1\u5668\u4e0a\uff0c\u8fd0\u884c",(0,o.jsx)(n.code,{children:"ssh-copy-id"}),"\uff0c\u6b64\u8fc7\u7a0b\u4f1a\u628a\u672c\u5730\u7684\u516c\u94a5\uff08\u5982",(0,o.jsx)(n.code,{children:"id_rsa.pub"}),"\uff09\u589e\u52a0\u5230\u670d\u52a1\u5668\u7684",(0,o.jsx)(n.code,{children:"moon:~/.ssh/authorized_keys"}),"\u4e0a\u3002\u7531\u4e8e\u76ee\u5f55\u5171\u4eab\uff0c\u6240\u6709\u670d\u52a1\u5668\u90fd\u53ef\u4ee5\u9a8c\u8bc1\u672c\u5730\u7684\u5bc6\u94a5\u8fdb\u884c\u767b\u5f55\u3002\u5207\u8bb0\uff0c",(0,o.jsx)(n.strong,{children:"\u4e0d\u8981\u4e0a\u4f20\u6216\u6cc4\u9732\u79c1\u94a5"}),"\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'# local machine\n<your-name>@<local-machine>:~$ ssh-copy-id moon\n/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "<path-to-your-home>/.ssh/id_rsa.pub"\n/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\n/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\nourunmin@moon\'s password: <your-password>\nNumber of key(s) added: 1\nNow try logging into the machine, with\n    "ssh moon"\nand check to make sure that only the key(s) you wanted were added.\n'})}),"\n",(0,o.jsx)(n.h2,{id:"2-\u670d\u52a1\u5668\u5bc6\u94a5\u914d\u7f6e\u548c\u811a\u672c\u914d\u7f6e",children:"2. \u670d\u52a1\u5668\u5bc6\u94a5\u914d\u7f6e\u548c\u811a\u672c\u914d\u7f6e"}),"\n",(0,o.jsx)(n.h3,{id:"21-\u670d\u52a1\u5668\u5bc6\u94a5\u914d\u7f6e",children:"2.1 \u670d\u52a1\u5668\u5bc6\u94a5\u914d\u7f6e"}),"\n",(0,o.jsxs)(n.p,{children:["\u670d\u52a1\u5668\u4e5f\u9700\u8981\u4e00\u4e2a\u5bc6\u94a5\uff0c\u7528\u4e8e\u542f\u52a8sshd\u670d\u52a1\uff0c\u540c1.\uff0c\u8fd0\u884c",(0,o.jsx)(n.code,{children:"ssh-keygen"}),"\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# server moon\n<your-name>@moon:~$ ssh-keygen\nGenerating public/private rsa key pair.\n<snip>\n"})}),"\n",(0,o.jsx)(n.h3,{id:"22-\u670d\u52a1\u5668\u811a\u672c\u914d\u7f6e",children:"2.2 \u670d\u52a1\u5668\u811a\u672c\u914d\u7f6e"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u5728\u767b\u5f55\u8282\u70b9moon\u4fdd\u5b58\u5982\u4e0b\u811a\u672c\uff0c\u5982\u53eb",(0,o.jsx)(n.code,{children:"debug.sh"}),"\u3002",(0,o.jsxs)(n.strong,{children:["\u6ce8\u610f\u66f4\u6539\u7aef\u53e3",(0,o.jsx)(n.code,{children:"PORT=2222"}),"\u548c\u4e0a\u9762",(0,o.jsx)(n.a,{href:"#12-%E6%9C%AC%E5%9C%B0ssh%E9%85%8D%E7%BD%AE",children:"1.2 \u672c\u5730SSH\u914d\u7f6e"}),"\u7684\u3010\u7aef\u53e3\u53f7\u3011\u4e00\u6837"]}),"\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n#SBATCH --time=01:00:00\n#SBATCH --job-name="code-tunnel"\n#SBATCH --signal=B:TERM@60 # tells the controller\n                        # to send SIGTERM to the job 60 secs\n                        # before its time ends to give it a\n                        # chance for better cleanup.\n\nPORT=2222\n\ncleanup() {\n    echo "Caught signal - removing SLURM env file"\n    rm -f ~/.code-tunnel-env.bash\n}\n\n# Trap the timeout signal (SIGTERM) and call the cleanup function\ntrap \'cleanup\' SIGTERM\n\n# store SLURM variables to file\nenv | awk -F= \'$1~/^SLURM_/{print "export "$0}\' > ~/.code-tunnel-env.bash\n\n# check port occupation\nif [ -n "$(lsof -i:${PORT})" ]; then\n    # send error message to stdout and stderr\n    # echo "Port ${PORT} is already in use, please change the port number and resubmit the job, remember to change the local ssh configuration file as well" >&2\n    echo "\u7aef\u53e3${PORT}\u5df2\u88ab\u5360\u7528\uff0c\u8bf7\u66f4\u6539\u7aef\u53e3\u53f7\uff0c\u5e76\u91cd\u65b0\u63d0\u4ea4\u4efb\u52a1\uff0c\u6ce8\u610f\u672c\u5730ssh\u914d\u7f6e\u6587\u4ef6\u4e5f\u8981\u66f4\u6539" >&2\n    exit 1\nfi\n/usr/sbin/sshd -D -p ${PORT} -f /dev/null -h ${HOME}/.ssh/id_rsa &\nwait\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u5728",(0,o.jsx)(n.code,{children:"~/.bashrc"}),"\u6587\u4ef6\u589e\u52a0\u4e0b\u9762\u7684\u6307\u4ee4\uff0c\u52a0\u8f7dSLURM\u76f8\u5173\u7684\u73af\u5883\u53d8\u91cf"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# source slurm environment if we're connecting through code-tunnel\n[ -f ~/.code-tunnel-env.bash ] && source ~/.code-tunnel-env.bash\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"3-\u6bcf\u6b21\u8c03\u8bd5\u8fd0\u884c\u7684\u65b9\u6cd5",children:"3. \u6bcf\u6b21\u8c03\u8bd5\u8fd0\u884c\u7684\u65b9\u6cd5"}),"\n",(0,o.jsxs)(n.p,{children:["\u6bcf\u6b21\u9700\u8981\u8c03\u8bd5\u7684\u65f6\u5019\uff0c\u5c31",(0,o.jsx)(n.strong,{children:"\u63d0\u4ea4\u4e00\u4e2a\u4efb\u52a1\uff0c\u7533\u8bf7GPU\u8d44\u6e90\uff0c\u7136\u540e\u518d\u4f7f\u7528vscode\u8fde\u63a5\u5230\u8c03\u8bd5\u8282\u70b9"}),"\u3002"]}),"\n",(0,o.jsx)(n.h3,{id:"31-\u63d0\u4ea4\u4efb\u52a1",children:"3.1 \u63d0\u4ea4\u4efb\u52a1"}),"\n",(0,o.jsx)(n.p,{children:"\u5728\u8c03\u8bd5\u8282\u70b9\u4e0a\u63d0\u4ea4\u4efb\u52a1\uff0c\u5982\u7533\u8bf7\u4e00\u4e2aGPU\uff0c\u5219\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"cd <your-workspace>\nsbatch --gres=gpu:1 debug.sh\n"})}),"\n",(0,o.jsx)(n.h3,{id:"32-vscode\u8fde\u63a5",children:"3.2 vscode\u8fde\u63a5"}),"\n",(0,o.jsxs)(n.p,{children:["\u672c\u5730vscode\u5c31\u53ef\u4ee5\u767b\u5f55\u5230",(0,o.jsx)(n.code,{children:"hpc-job"}),"\u8fd9\u4e2a\u8c03\u8bd5\u8282\u70b9\u8fdb\u884c\u8c03\u8bd5\u3002\u6ce8\u610f\uff0c\u63d0\u4ea4\u7684\u4efb\u52a1\u9650\u65f6\u4e3a1\u5c0f\u65f6\uff0c\u8fc7\u540e\u81ea\u52a8\u65ad\u5f00\u3002"]}),"\n",(0,o.jsxs)(n.p,{children:["\u53c2\u8003\u94fe\u63a5\uff1a",(0,o.jsx)(n.a,{href:"https://github.com/microsoft/vscode-remote-release/issues/1722#issuecomment-1938924435",children:"Cluster workflow feature to allow shell commands or script to run before remote server setup (e.g. slurm) (wrap install script)\n"})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var o=s(6540);const r={},i=o.createContext(r);function t(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);